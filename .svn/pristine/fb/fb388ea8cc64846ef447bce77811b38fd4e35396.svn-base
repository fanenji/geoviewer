<!DOCTYPE HTML>

<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <meta charset="utf-8">
    <title>COREM - Distribuzione Specie</title>

    <link rel="stylesheet" type="text/css" href="/geoviewer/stili/extjs/resources/css/ext-all.css"/>
    <link rel="stylesheet" type="text/css" href="../../../stili/default/base.css"/>
    <!-- librerie js -->
    <script src="http://maps.google.com/maps/api/js?sensor=false&v=3.2&language=it"></script>
    <script src="../../../lib/OpenLayers/OpenLayers.js" type="text/javascript"></script>
    <script src='../../../lib/proj4js/lib/proj4js-min.js'></script>
    <!-- jQuery -->
    <script src="../../../lib/jQuery/jquery-1.7.min.js"></script>
    <!-- ExtJs -->
    <script type="text/javascript" src="/geoviewer/lib/ExtJs/ext.js"></script>
    <!-- CWN2 -->
    <script src="../../../lib/Cwn2/cwn2.js"></script>
    <script src="../../../lib/Cwn2/deploy-config.js"></script>

    <!-- CUSTOM -->
    <script src="corem.js"></script>


</head>

<body>

<script>

    Ext.application({
        name: 'CoremVisualizzazioneSpecie',

        launch: function() {
            // imposto la url del servizio di configurazione
            var idSession = CWN2.Util.getUrlParam('ID_SESSION');
            var ruolo = CWN2.Util.getUrlParam('RUOLO');

            var config = {
                "application": {
                    "mapOptions": {
                        //"displayProjection": "EPSG:3857",
                        "initialExtent": "460000,4703913,1398525,5900000",
                        "restrictedExtent": "460000,4703913,1398525,5900000"
                    },
                    "layout": {
                        "mapTitle": "Filtro Cartografico",
                        "statusBar": true,
                        "widgets": [
                            { "name": "Scale" },
                            { "name": "CoordinateReadOut" }
                        ],
                        "toolbar": {
                            "itemGroups": [
                                {
                                    "items": [
                                        { "name": "pan" },
                                        { "name": "zoomin" },
                                        { "name": "zoomout" },
                                        { "name": "fitall" },
                                        { "name": "zoomToInitialExtent" },
                                        { "name": "zoomprevious" },
                                        { "name": "zoomnext" }
                                    ]
                                },
                                {
                                    "items": [
                                        { "name": "measureline" },
                                        { "name": "measurearea" }
                                    ]
                                },
                                {
                                    "items": [
                                        {"name": "transparency" },
                                        {"name": "loadlayers",
                                            "panels": [
                                                {
                                                    "type": "layerTree",
                                                    "name": "Temi",
                                                    "options": {
                                                        "treeServiceUrl": "http://geoportale.regione.liguria.it//geoservices/REST/corem/load_layer_tree/",
                                                        "layersConfigServiceUrl": "http://geoportale.regione.liguria.it//geoservices/REST/corem/load_layer_config/"
                                                    }
                                                }
                                            ]
                                        },
                                        {"name": "removelayers" },
                                        {"name": "infowms",
                                            "options": {
                                                "layers": "COREM_OSS",
                                                "disableHilite": true,
                                                "radius": 10,
                                                "maxFeatures": 10,
                                                "zoomToSelected": true,
                                                "zoomLevel": 11,
                                                "vendorParams": {
                                                    "EXP_FILTER": "ID_SESSION = " + idSession
                                                }
                                            }
                                        },
                                        {"type": "combo", "name": "geocoder"}

                                    ]
                                },
                                {
                                    "align": "right",
                                    "items": [
                                        {"name": "simpleLegend"}
                                    ]
                                }
                            ]
                        }
                    }
                },
                "baseLayers": [
                    { "type": "no_base" },
                    { "type": "bing_aerial", "visible": true}
                ],
                "layers": [
                    {
                        type: "WMS",
                        name: "COREM_LIM_AMM",
                        visible: true,
                        projection: "EPSG:25832",
                        minScale: 0,
                        maxScale: 0,
                        opacity: 0.6,
                        showInLegend: true,
                        geomSubType: "POLYGON",
                        legend: {
                            "label": "Limiti Amministrativi",
                            "icon": "http://www.cartografiarl.regione.liguria.it/mapserver/mapserv.exe?MAP=E://progetti/mapfiles/corem/corem.map&LAYER=COREM_REGIONI&RULE=COREM_REGIONI&request=GETLEGENDGRAPHIC&version=1.1&SERVICE=WMS&FORMAT=image/png"
                        },
                        infoOptions: {
                            infoIdAttr: "ID",
                            infoUrl: null
                        },
                        classes: [],
                        wmsParams: {
                            url: COREM_wmsUrl,
                            name: "COREM_REGIONI,COREM_PROVINCE,COREM_COMUNI",
                            transparent: true
                        }
                    }
                ]

            };

            // carico la mappa
            CWN2.app.load({
                appConfig: config,
                callBack: function() {
                    // loadGrid Ã¨ definita in corem.js
                    if (ruolo === "LIBIOSS_PRI" || ruolo === "LIBIOSS_PUB") {
                        loadSpecie(idSession,ruolo);
                    } else {
                        loadGrid(idSession);
                    }
                },
                debug: true
            });

        }
    });

</script>

</body>
</html>
		