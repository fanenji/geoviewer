<!DOCTYPE HTML>

<html lang="it">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8">

    <title>GeoStyler Raster Mask</title>

    <link rel="stylesheet" type="text/css" href="/geoviewer/stili/extjs/resources/css/ext-all-gray.css"/>
    <link rel="stylesheet" type="text/css" href="/geoviewer/stili/default/base.css"/>
    <link rel="stylesheet" type="text/css" href="raster.css">
    <script src="http://maps.google.com/maps/api/js?sensor=false&v=3.2&language=it"></script>
    <script type="text/javascript" src="/geoviewer/lib/ExtJs/ext.js"></script>
    <script src="/geoviewer/lib/OpenLayers/OpenLayers.js" type="text/javascript"></script>
    <script src='/geoviewer/lib/proj4js/lib/proj4js-min.js'></script>

    <script src="/geoviewer/lib/Cwn2/cwn2-debug.js"></script>

    <script src="/geoviewer/lib/Cwn2/deploy-config.js"></script>

    <script type='text/javascript' src="https://x2js.googlecode.com/hg/xml2json.js"></script>

</head>
<body>

<script>

    Ext.define('CWN2.button.GeoStyler.RasterSave', {
        extend: 'Ext.button.Button',
        alias: 'widget.cwn2-button-geostyler-raster-save',
        id: "geostyler-raster-save",
        iconCls: "geoStylerRasterSave",
        handler: function () {
            //TODO conversione sistema coordinate
            //quando si carica la mappa impostare la display projection a quella della mappa
            var geom = CWN2.Editor.getEditingGeom(CWN2.app.map,"WKT");
            if (Array.isArray(geom)) {
                console.log(geom[0]);
            } else {
                console.log(geom);
            }
        }
        //,text: 'Salva'
    });

Ext.application({

    name: 'GeoStyler',

    geoServerFontList: [],

    x2js: null,

    getStyles: function(idMap) {
        if (!idMap) {
            return;
        }

        var me = this;

        Ext.each(CWN2.app.map.layerManager.overlayLayersConfig, function(layer) {
            if (layer.idMap != idMap) {
//                CWN2.app.map.layerManager.setLayerVisible(layer.name,false);
            }
            if (layer.geomType === "RASTER") {
            }
        });

    },

    launch: function() {

        var idMap = decodeURIComponent(CWN2.Util.getUrlParam('id'));
        if (idMap === "null") {
            idMap = null;
        }

        var config = {
            "application": {
                "mapOptions": {
                    "restrictedExtent": "830036,5402959,1123018,5597635"
                },
                "layout": {
                    "statusBar": true,
                    "legend": null,
                    "legend": {
                        "type": "simple",
                        "position": "east",
                        "collapsed": false
                    },
                    "widgets": [
                        { "name": "Scale" },
                        { "name": "CoordinateReadOut" }
                    ],
                    "toolbar": {
                        "itemGroups": [
                            {
                                "items": [
                                    { "name": "pan" },
                                    { "name": "zoomin" },
                                    { "name": "zoomout" },
                                    { "name": "fitall" },
                                    { "name": "zoomToInitialExtent" },
                                    { "name": "zoomprevious" },
                                    { "name": "zoomnext" }
                                ]
                            },
                            {
                                "name": "avanzate",
                                "items": [
                                    {"name": "infowms" },
                                    {"name": "removelayers" },
                                    {"name": "find", "panels": [{ "type": "layer", "name": "Livello" }]},
                                    {"type": "combo", "name": "geocoder"}
                                ]
                            },
                            {
                                "name": "editing",
                                "items": [
                                    {
                                        "type": "button",
                                        "name": "drawPolygon",
                                        "options": {
                                            "singleFeature": true
                                        }
                                    },
                                    {
                                        "type": "button",
                                        "name": "modifyFeature",
                                        "options": {
                                        }
                                    },
                                    {
                                        "type": "button",
                                        "name": "dragFeature",
                                        "options": {}
                                    },
                                    {
                                        "type": "button",
                                        "name": "deleteFeature",
                                        "options": {}
                                    },
                                    {
                                        "type": "button",
                                        "name": "geostyler-raster-save",
                                        "options": {}
                                    }
                                ]
                            }
                        ]
                    }
                }
            },
            "baseLayers": [
                { "type": "no_base" , "visible": true},
                { "type": "google_satellite"},
                { "type": "rl_ortofoto_2013" }
            ],
            "layers": []
        };

        CWN2.Globals.NO_GWC_CACHE = true;

        CWN2.app.load({
            appConfig: config,
            divID: "cwn2_map",
            callBack: this.getStyles,
            callBackArgs: idMap,
            idMap: idMap,
            flagGeoserver: true,
            geoserverUrl: "http://geoservizi.datasiel.net:8080/",
            debug: true
        });

    } //eo launch

});



</script>

</body>
</html>
